<!-- ./cli/medperf/web-ui/templates/mlcube_detail.html -->
{% extends "detail_base.html" %}
{% import 'association_card_macros.html' as macros %}

{% block title %}MLCube Details{% endblock %}

{% block optional_styles %}
.yaml-container {
    display: flex;
    justify-content: center; /* Center the detail panel initially */
    width: 100%;
}

.yaml-panel {
    flex: 0 0 40%;
    max-width: 40%;
    min-width: 300px;
    height: 100vh;
    overflow: auto;
    display: none; /* Hidden initially */
}

.detail-panel {
    flex: 1;
    max-width: 60%;
    padding-right: 20px;
    box-sizing: border-box;
    transition: max-width 0.3s, margin 0.3s; /* Smooth transition */
}

.yaml-panel-visible .yaml-container {
    justify-content: flex-start; /* Align detail panel to the left when YAML panel is visible */
}

.yaml-panel-visible .detail-panel {
    max-width: 60%; /* Adjust to take 60% width when YAML panel is visible */
    margin-right: 20px;
}

@media (max-width: 992px) {
    .detail-panel {
        max-width: 100%;
        padding-right: 0;
    }

    .yaml-panel {
        max-width: 100%;
        display: none;
    }
}

@media (max-width: 768px) {
    .yaml-container {
        flex-direction: column;
    }

    .yaml-panel {
        display: none;
        height: auto;
    }
}
{% endblock %}

{% block detail_panel %}
<div class="yaml-container">
    <div class="detail-panel">
        <h1 class="my-4">{{ entity.name }}</h1>
        <div class="{% if entity.is_valid %}card{% else %}invalid-card{% endif %}">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="card-title mb-0">Details</h5>
                    <span class="badge {% if entity.state == 'OPERATION' %}badge-state-operational{% else %}badge-state-development{% endif %}">
                        {{ entity.state }}
                    </span>
                    <span class="badge {% if entity.is_valid %}badge-valid{% else %}badge-invalid{% endif %}">
                        {% if entity.is_valid %}Valid{% else %}Invalid{% endif %}
                    </span>
                </div>
                <div class="card mb-3">
                    <div class="card-body">
                        <p class="card-text"><strong>MLCube:</strong> <a href="{{ entity.git_mlcube_url }}" class="text-primary yaml-link" target="_blank">{{ entity.git_mlcube_url }}</a></p>
                        <p class="card-text text-muted small">{{ entity.mlcube_hash }}</p>
                        <p class="card-text"><strong>Parameters:</strong> <a href="{{ entity.git_parameters_url }}" class="text-primary yaml-link" target="_blank">{{ entity.git_parameters_url }}</a></p>
                        <p class="card-text text-muted small">{{ entity.parameters_hash }}</p>
                        {% if entity.image_tarball_url %}
                            <p class="card-text"><strong>Image Tarball:</strong> <a href="{{ entity.image_tarball_url }}" class="text-primary" target="_blank">{{ entity.image_tarball_url }}</a></p>
                            <p class="card-text text-muted small">{{ entity.image_tarball_hash }}</p>
                        {% else %}
                            <p class="card-text"><strong>Image Tarball:</strong> Not Available</p>
                            <p class="card-text text-muted small">N/A</p>
                        {% endif %}
                        {% if entity.additional_files_tarball_url %}
                            <p class="card-text"><strong>Additional Files:</strong> <a href="{{ entity.additional_files_tarball_url }}" class="text-primary" target="_blank">{{ entity.additional_files_tarball_url }}</a></p>
                            <p class="card-text text-muted small">{{ entity.additional_files_tarball_hash }}</p>
                        {% else %}
                            <p class="card-text"><strong>Additional Files:</strong> Not Available</p>
                            <p class="card-text text-muted small">N/A</p>
                        {% endif %}
                    </div>
                </div>
                <div class="card mb-3">
                    <div class="card-body d-flex justify-content-between flex-wrap">
                        <div class="w-50">
                            <p class="card-text"><strong>Image Hash:</strong> <span class="text-muted small">{{ entity.image_hash }}</span></p>
                            <p class="card-text"><i class="fas fa-user"></i> <span class="text-muted small">{{ entity.owner }}</span></p>
                        </div>
                        <div class="text-right w-50">
                            <p class="card-text"><strong>Created:</strong> <span class="text-muted small" data-date="{{ entity.created_at }}"></span></p>
                            <p class="card-text"><strong>Modified:</strong> <span class="text-muted small" data-date="{{ entity.modified_at }}"></span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="associations-panel">
            <div class="associations-column">
                <h2 class="my-4">Associated Benchmarks</h2>
                {% for assoc in benchmarks_associations %}
                    {{ macros.association_card(assoc, benchmarks[assoc.benchmark], "benchmarks") }}
                {% endfor %}
            </div>
        </div>
    </div>
    <div class="yaml-panel" id="yaml-panel">
        <h5>YAML Content</h5>
        <div id="loading-indicator" class="spinner" style="display: none;"></div>
        <pre><code id="yaml-code" class="language-yaml"></code></pre>
    </div>
</div>
{% endblock %}

{% block optional_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        $('.yaml-link').on('click', function(event) {
            event.preventDefault();
            const url = $(this).attr('href');
            $('#yaml-panel').show();
            $('.yaml-container').addClass('yaml-panel-visible');
            $('#loading-indicator').show();
            $('#yaml-code').hide();
            $.get('/fetch-yaml', { url: url }, function(data) {
                $('#yaml-code').text(data.content);
                Prism.highlightElement($('#yaml-code')[0]);
                $('#loading-indicator').hide();
                $('#yaml-code').show();
            }).fail(function() {
                $('#yaml-code').text('Failed to load content');
                $('#loading-indicator').hide();
                $('#yaml-code').show();
            });
        });
    });
</script>
{% endblock %}
