# Model MLCube for Frame-wise Video Classification Metrics

This MLCube is for evaluating Frame-wise video classification models.<br><br>


## Input Data Structure

The following (default) directory tree is expected:

```
surg_metrics
├── mlcube
│   ├── workspace
│   │   ├── data
│   │   │   ├── frames
│   │   │   └── data_csv
│   │   │
│   │   ├── parameters.yaml
│   │   │
│   │   └── predictions
│   │       ├── some_video.csv
│   │       ├── other_video.csv
│   │       └ ...
│   │   
│   └── mlcube.yaml
└── project

```

The locations and names of each of ```data```, ```predicitons```, and ```parameters.yaml``` can be different but should be specified either in [mlcube.yaml](mlcube/mlcube.yaml) or the command line arguments when running the MLCube using the ```mlcube``` tool.

The folder ```data``` should have the same structure as the same named folder generated by the [data preparation MLCube](../surg_prep/README.md). This folder is currently not used by the MLCube, only specified to fit the standards when registering the MLCube with the [MedPerf](https://github.com/mlcommons/medperf) Platform.

The folder ```predictions``` should have the same structure as the same named folder generated by the [model MLCube](../surg_model_TeCNO/README.md).

<br><br>

## Configuration

The following parameters can be adjusted in the [parameters.yaml](mlcube/workspace/parameters.yaml) file for configuring the metrics calculation:

  * ```metrics```: A list of metric names to calculate. Currently supported metrics are:
    * f1-score
    * accuracy
    * jaccard
    * recall
    * precision
  * ```num_classes```: The number of classes in the dataset.

<br><br>

## MLCube built-in Tasks

The final (default) directory tree will be as follows:
<pre>
surg_metrics
├── mlcube
│   ├── workspace
│   │   ├── data
│   │   │   ├── frames
│   │   │   └── data_csv
│   │   │
│   │   ├── parameters.yaml
│   │   │
│   │   ├── predictions
│   │   │   ├── some_video.csv
│   │   │   ├── other_video.csv
│   │   │   └ ...
│   │   │
│   │   └── <b>results.yaml</b>
│   │   
│   └── mlcube.yaml
└── project
</pre>

The location and name of ```results.yaml``` can be different but should be specified either in [mlcube.yaml](mlcube/mlcube.yaml) or the command line arguments when running the MLCube using the ```mlcube``` tool.

<br><br>

### Task ```evaluate```

The MLCube calculates the model performance metrics using the model predicitons and ground-truth labels found in ```predictions``` folder.
```results.yaml``` file will be generated containing the following:

  * For each metric, the overall metric value across the videos.
  * For each metric, the video-level mean and standard deviation of the metric value across the videos.
